<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="soccerTeam.mapper.SoccerTeamMapper">
	<select id="selectSoccerTeamList" resultType="soccerTeam.dto.SoccerTeamDto">
		select team_idx, title, team_name, region, team_number, team_period, team_day, team_time, team_old, need_position, need_position_number, athlete_number, contents, hit_cnt, created_datetime, creator_id, updated_datetime, updator_id
		from team
		 where deleted_yn = 'N'
		 order by team_idx desc
	</select>
	
	<insert id="insertSoccerTeam" parameterType="soccerTeam.dto.SoccerTeamDto" useGeneratedKeys="true" keyProperty="teamIdx">
		insert into team(title, team_name, region, team_number, team_period, team_day, team_time, team_old, need_position, need_position_number, athlete_number, contents, created_datetime, creator_id, updated_datetime, updator_id)
		values (#{title}, #{teamName}, #{region}, #{teamNumber}, #{teamPeriod}, #{teamDay}, #{teamTime}, #{teamOld}, #{needPosition}, #{needPositionNumber}, #{athleteNumber}, #{contents}, now(), #{creatorId}, now(), #{updatorId})
	</insert>
	
	<select id="selectSoccerTeamDetail" parameterType="int" resultType="soccerTeam.dto.SoccerTeamDto">
		select team_idx, title, team_name, region, team_number, team_period, team_day, team_time, team_old, need_position, need_position_number, athlete_number, contents, hit_cnt, created_datetime, creator_id, updated_datetime, updator_id
		from team
		 where deleted_yn = 'N'
		   and team_idx = #{teamIdx}   
	</select>
	
	<update id="updateHitCount" parameterType="int">
		update team
			set hit_cnt = hit_cnt +1
		where team_idx = #{teamIdx}
	</update>
	
	<update id="updateSoccerTeam" parameterType="soccerTeam.dto.SoccerTeamDto">
		update team
			set title = #{title}, 
				team_name = #{teamName}, 
				region = #{region}, 
				team_number = #{teamNumber}, 
				team_period = #{teamPeriod}, 
				team_day = #{teamDay}, 
				team_time = #{teamTime}, 
				team_old = #{teamOld}, 
				need_position = #{needPosition}, 
				need_position_number = #{needPositionNumber}, 
				athlete_number = #{athleteNumber}, 
				contents = #{contents}, 
				updated_datetime = now(), 
				updator_id = #{updatorId}
			where team_idx = #{teamIdx}
	</update>
	
	<delete id="deleteSoccerTeam" parameterType="soccerTeam.dto.SoccerTeamDto">
		update team
			set deleted_yn = 'Y',
				updated_datetime = now(),
				updator_id = #{updatorId}
		where team_idx = #{teamIdx}
	</delete>
	
	<insert id="insertSoccerTeamFileList" parameterType="soccerTeam.dto.SoccerTeamFileDto">
		insert into team_file
		(team_idx, original_file_name, stored_file_path, file_size, creator_id, created_datetime)
		values
		<foreach collection="list" item="item" separator=",">
		( #{item.teamIdx}, #{item.originalFileName}, #{item.storedFilePath}, #{item.fileSize}, 'admin', now())
		</foreach>
	</insert>
	
	<select id="selectSoccerTeamFileList" parameterType="int" resultType="soccerTeam.dto.SoccerTeamFileDto">
		select team_file_idx, team_idx, original_file_name, stored_file_path, format(round(file_size/1024), 0) as file_size
	  from team_file
		where team_idx = #{teamIdx} and deleted_yn = 'N'
	</select>
	
	<select id="selectSoccerTeamFileInfo" parameterType="map" resultType="soccerTeam.dto.SoccerTeamFileDto">
		select original_file_name, stored_file_path, file_size
		from team_file
		where team_file_idx = #{teamFileIdx} and team_idx = #{teamIdx} and deleted_yn = 'N'
	</select>
</mapper>
